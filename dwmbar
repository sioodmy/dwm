#!/bin/bash

music () {
	
	volume=$(mpc volume | sed 's:.*\:::') || exit
	echo $volume | grep n/a > /dev/null && exit

	current=$(mpc current) && \
		[[ current = "" ]] && exit || \
		[[ current = "n/a" ]] && exit || \
		mpc status | grep playing > /dev/null && echo -n "^c#d08770^墳$volume ^c#bf616a^ $current" || echo -n "^c#d08770^墳$volume ^c#bf616a^ $current"
	
}

clock () {
	echo -n "^c#81a1c1^ $(date +%d.%m.%y) ^c#5e81ac^ $(date +%H:%M)"
	
}

ram () {
	echo -n "^c#a3be8c^  $(free -h | awk '/^Mem/ { print $3 }' | sed s/i//g)"
}

cpu () {
	echo -n "^c#ebcb8b^  $(grep -o "^[^ ]*" /proc/loadavg)"
}

export -f music 

update () {

	dwm -s " $(cpu) $(ram) $(mpc status > /dev/null && music) $(clock) "
}

export -f update

while true; do
	sleep 1 && update
done &

while true; do
	mpc idle && update
done &
